# 🚨 Star Tracker 담당자 확인 필수 사항 (완전판)

**작성일**: 2026-01-29
**목적**: 발사 전 코드 검증을 위한 담당자 미팅 체크리스트
**긴급도**: 🔴 매우 높음 (발사 임박)

---

## 📊 문제 요약 대시보드

| 심각도 | 개수 | 설명 |
|:------:|:----:|------|
| 🔴 CRITICAL | 4 | 발사 불가 수준, 즉시 해결 필요 |
| 🟠 HIGH | 4 | 심각한 버그, 운용 중 문제 발생 |
| 🟡 MEDIUM | 3 | 기능 미완성, 품질 이슈 |
| ⚡ 전력 | 2 | 전력 예산 불일치 |
| **총계** | **13** | |

---

# 🔴 CRITICAL 이슈 (발사 불가 수준)

---

## C1. 카메라 이미지 → 알고리즘 연결 없음

### 현재 상태
```
실제 데이터 흐름:
OV4689 카메라 → MIPI → HLS IP (CFA, RGB2Gray) → DDR 저장
                                                    ↓
                                          [여기서 끊김!]
                                                    ↓
star_ID() ← 하드코딩된 테스트 데이터 사용 중 (실제 이미지 무시)
```

### 발견 위치
- **파일**: `cli_func.c`
- **라인**: 793-794

### 질문
```
□ Q-C1a: 카메라 이미지가 star_ID()에 어떻게 전달되나요?
□ Q-C1b: DDR에 저장된 이미지를 읽어서 처리하는 코드는 어디에?
□ Q-C1c: 이 연결이 안 되어 있으면 별 추적이 불가능한데, 인지하고 계신가요?
```

---

## C2. 하드코딩된 테스트 데이터

### 발견 위치
- **파일**: `system.sdk/ssov/src/algorithm/my_star_id.c`
- **라인**: 69-96

### 현재 코드
```c
// my_star_id.c:69-96 - 하드코딩된 테스트 데이터
idx.label_num = 13;  // ← 별 개수가 고정값 13

centroids[0][0] = 0.0015152955790524894;   // 별 #0 좌표
centroids[0][1] = -0.0026922287577098372;
centroids[1][0] = 0.0024254777848847792;   // 별 #1 좌표
centroids[1][1] = 0.0034076698820866087;
// ... 13개 별 좌표 모두 직접 입력됨
```

### 문제점
| 항목 | 설명 |
|------|------|
| 원인 | 테스트용 데이터가 제거되지 않음 |
| 증상 | 카메라가 어느 방향을 봐도 같은 자세값 출력 |
| 결과 | **위성 자세제어 완전 불가능** |

### 질문
```
□ Q-C2a: 이 테스트 데이터는 언제 실제 카메라 데이터로 교체되나요?
□ Q-C2b: centroid_data_set() 함수가 존재하는데 왜 사용 안 하나요?
□ Q-C2c: 실제 이미지에서 별 검출(Threshold + CCL) 하는 코드는 어디에?
□ Q-C2d: 이 상태로 발사하면 미션 실패 아닌가요?
```

---

## C3. 자동 실행 모드 미구현

### 발견 내용
- `star_ID()`, `star_QUEST()`는 **CLI 명령 "2 5"로만** 호출됨
- `main()` 루프에 자동 실행 코드 **없음**
- CLI "2 1" (StarID on) 명령은 **빈 구현**

### 발견 위치
- **파일**: `cli_func.c`
- **라인**: 793-794 (호출 위치)
- **주석**: `// 임시 테스트` 라고 되어 있음

### 현재 구현 상태
```c
// cli_func.c - 실제 코드
case 1:  // StarID on
    break;  // ← 아무것도 안 함!

case 2:  // StarID off
    break;  // ← 아무것도 안 함!

case 5:  // 임시 테스트
    star_ID();      // ← 여기서만 호출됨
    star_QUEST();
    break;
```

### 질문
```
□ Q-C3a: 위성이 궤도에서 자동으로 별 추적을 시작하는 코드는 어디에?
□ Q-C3b: OBC에서 명령을 보내면 동작하는 건가요?
□ Q-C3c: "2 1" (StarID on) 명령이 왜 빈 구현인가요?
□ Q-C3d: 5Hz 자동 운용 모드 구현 계획이 있나요?
```

---

## C4. 해상도 3중 불일치

### 발견 내용

| 구성요소 | 해상도 | 파일 위치 | 비고 |
|---------|--------|----------|------|
| OV4689 센서 | 2688×1520 | 하드웨어 스펙 | 실제 센서 |
| HLS IP | 1280×720 | cfa.cpp, rgb2gray.cpp | FPGA 처리 |
| 알고리즘 | 2048×1088 | globalV.h:15-16 | 소프트웨어 |

### 문제점
```
센서는 2688×1520 출력 → FPGA는 1280×720으로 처리 → 알고리즘은 2048×1088 기대

→ 데이터 크기 불일치로 이미지 깨짐 또는 잘못된 좌표 계산
```

### 발견 위치
```c
// ip_repo/cfa/src/cfa.cpp
#define MAX_WIDTH  1280
#define MAX_HEIGHT 720

// ip_repo/rgb2gray/src/rgb2gray.cpp
#define MAX_WIDTH  1280
#define MAX_HEIGHT 720

// algorithm/globalV.h:15-16
#define MAX_IMAGESIZE_X  2048
#define MAX_IMAGESIZE_Y  1088
```

### 질문
```
□ Q-C4a: 실제 운용 해상도가 무엇인가요? (1280×720? 2048×1088? 2688×1520?)
□ Q-C4b: 다운스케일해서 처리하는 건가요? 그렇다면 어디서?
□ Q-C4c: 좌표계 변환이 어디에 구현되어 있나요?
```

---

# 🟠 HIGH 이슈 (심각한 버그)

---

## H1. Division by Zero 위험

### 발견 위치
- **파일**: `my_Attitude_Estimation.c`
- **라인**: 68-74, 94

### 문제 코드
```c
// my_Attitude_Estimation.c:68-74
// Newton-Raphson 반복에서 J(야코비안) == 0 체크 없음
lambda = lambda - f/J;  // J가 0이면 프로그램 크래시

// my_Attitude_Estimation.c:94
double norm = sqrt(gamma*gamma + x[0]*x[0] + x[1]*x[1] + x[2]*x[2]);
q[0] = gamma / norm;  // norm이 0이면 크래시
```

### 질문
```
□ Q-H1a: 이런 예외 상황 테스트한 적 있나요?
□ Q-H1b: 별이 적게 검출되거나 못 찾으면 어떻게 되나요?
□ Q-H1c: 프로그램 크래시 시 위성 복구 절차는?
```

---

## H2. 배열 오버플로우 위험

### 발견 내용
```c
// globalV.h
#define _DEF_MAX_OBJ 2000  // 최대 검출 객체 수 = 2000

// 그러나 실제 배열 크기는 50개만!
float b_i[50][3];       // globalV.h:76
float r_i[50][3];       // globalV.h:77
int check_stars[50];    // globalV.h:78
```

### 문제점
```
만약 51개 이상의 별이 검출되면:
→ 배열 범위 초과 쓰기
→ 메모리 손상
→ 프로그램 크래시 또는 잘못된 계산
```

### 질문
```
□ Q-H2a: 실제 한 프레임에서 몇 개 별이 검출되나요?
□ Q-H2b: 50개 제한에 대한 경계 체크가 있나요?
□ Q-H2c: FOV 26도, 등급 6.5까지 보이면 수백 개 별이 보일 수 있는데요?
```

---

## H3. 파라미터 불일치 (렌즈/센서)

### 발견 내용

| 파라미터 | 코드 값 | 하드웨어/문서 | 차이 |
|---------|---------|--------------|------|
| **FOV** | 26.0° (my_star_id.c:9) | 14° (CLAUDE.md) | **1.86배** |
| **픽셀 크기** | 5.5µm (my_star_id.c:14) | 2µm (OV4689) | **2.75배** |
| **초점거리** | 25.21mm (my_star_id.c:12) | ? | **미확인** |

### 발견 위치
```c
// my_star_id.c:9
static float FOV = 26.0*pi/180.0;  // 26도

// my_star_id.c:12
static float focal_length = 25.21*0.001;  // 25.21mm

// my_star_id.c:14
static float pixel_size = 5.5*0.000001;  // 5.5µm
```

### 문제점
```
파라미터가 잘못되면:
→ 별 간 각거리 계산 오류
→ K-vector 검색 실패
→ 별 식별(Star ID) 실패
→ 자세 추정 완전 오류
```

### 질문
```
□ Q-H3a: 실제 탑재된 렌즈의 FOV가 얼마인가요? (14° vs 26°)
□ Q-H3b: 픽셀 크기 5.5µm는 어떤 센서 기준인가요? OV4689는 2µm입니다.
□ Q-H3c: 초점거리 25.21mm가 맞나요?
□ Q-H3d: hc.Yoon(2018년 작성)이 다른 프로젝트 코드를 가져온 건가요?
```

---

## H4. 클럭 도메인 크로싱 이슈

### 발견 내용
```
MIPI D-PHY RX: 250MHz (고속 직렬)
PL 이미지 처리: 200MHz
PS (ARM): 667MHz

→ 클럭 도메인 간 데이터 전달 시 CDC 처리 필요
→ CDC 로직 존재 여부 미확인
```

### 질문
```
□ Q-H4a: MIPI → AXI Stream 변환 시 FIFO나 CDC 처리가 있나요?
□ Q-H4b: 클럭 도메인 크로싱 관련 타이밍 분석 결과가 있나요?
□ Q-H4c: 데이터 손실이나 글리치 문제 테스트한 적 있나요?
```

---

# 🟡 MEDIUM 이슈 (기능 미완성)

---

## M1. 빈 CLI 명령 구현

### 발견 위치
- **파일**: `cli_func.c`

### 빈 구현 목록
```c
case 1:  // StarID on     - 빈 구현
case 2:  // StarID off    - 빈 구현
case 3:  // LVDS on       - 빈 구현
case 4:  // LVDS off      - 빈 구현
```

### 질문
```
□ Q-M1a: 이 명령들 구현 계획이 있나요?
□ Q-M1b: LVDS 인터페이스가 사용되나요?
```

---

## M2. 에러 핸들링 부재

### 발견 내용
- 별 검출 실패 시 처리 없음
- QUEST 알고리즘 수렴 실패 시 처리 없음
- 통신 오류 시 재시도 로직 없음
- 센서 초기화 실패 시 복구 없음

### 질문
```
□ Q-M2a: 별이 하나도 안 보이면 어떻게 되나요?
□ Q-M2b: 알고리즘 실패 시 폴백 모드가 있나요?
□ Q-M2c: 워치독 타이머가 구현되어 있나요?
```

---

## M3. 메모리 관리 이슈

### 발견 내용
- cli_func.c에서 동적 메모리 할당 후 해제 경로 불명확
- 장시간 운용 시 메모리 누수 가능성

### 질문
```
□ Q-M3a: 메모리 프로파일링 한 적 있나요?
□ Q-M3b: 궤도에서 며칠 연속 운용 테스트 한 적 있나요?
```

---

# ⚡ 전력 이슈

---

## P1. 전력 예산 불일치

### 발견 내용

| 항목 | 값 | 출처 |
|-----|-----|-----|
| 폴더명 목표 | 1.9W | `ssov_v400_1p9w` |
| 현재 추정 | ~2.2W | XDC 분석, 컴포넌트 합산 |
| 요구사항 | 1W 이하? | 미확인 |

### 전력 구성 추정
| 컴포넌트 | 전력 |
|---------|------|
| Zynq PS (ARM) | ~0.5W |
| Zynq PL (FPGA) | ~0.8W |
| DDR3 메모리 | ~0.4W |
| OV4689 센서 | ~0.3W |
| 기타 (I/O 등) | ~0.2W |
| **합계** | **~2.2W** |

### 질문
```
□ Q-P1a: 전력 예산이 정확히 얼마인가요?
□ Q-P1b: 폴더명 1p9w는 1.9W 목표라는 뜻인가요?
□ Q-P1c: 현재 실측 전력 데이터가 있나요?
```

---

## P2. 전력 관리 미구현

### 발견 내용
- 듀티 사이클 구현 없음 (상시 풀 동작)
- DDR Self-refresh 모드 미사용
- 센서 저전력 모드 미사용
- FPGA 클럭 게이팅 없음

### 5Hz 운용 시 듀티 사이클 적용 가능
```
5Hz = 200ms 주기
- 활성: 150ms (촬영 + 처리)
- 슬립: 50ms (저전력)

듀티비: 75%
예상 전력: 2.2W × 0.75 + 0.2W × 0.25 = 1.7W
+ 추가 최적화로 ~0.8W까지 가능
```

### 질문
```
□ Q-P2a: 전력 관리 코드 구현 계획이 있나요?
□ Q-P2b: 듀티 사이클 운용이 허용되나요?
□ Q-P2c: 센서 standby 모드 사용 가능한가요?
```

---

# 📝 검증 관련 질문

---

## V1. 테스트 이력

```
□ Q-V1a: 실제 밤하늘 이미지로 테스트한 적 있나요?
□ Q-V1b: 시뮬레이션 환경에서 테스트한 적 있나요?
□ Q-V1c: 정확도 0.015° 달성 검증 데이터가 있나요?
□ Q-V1d: 환경 시험(온도, 진동) 후 테스트 결과는?
```

---

## V2. 문서화

```
□ Q-V2a: 시스템 요구사항 문서가 있나요?
□ Q-V2b: 인터페이스 제어 문서(ICD)가 있나요?
□ Q-V2c: OBC ↔ Star Tracker 통신 프로토콜 정의서?
□ Q-V2d: 별 카탈로그 생성 과정 문서?
```

---

## V3. 별 카탈로그

```
□ Q-V3a: tables.c의 1602개 별 목록, 검증 완료되었나요?
□ Q-V3b: 별 등급(magnitude) 필터링 기준이 뭔가요?
□ Q-V3c: K-vector 테이블 생성 과정이 문서화되어 있나요?
□ Q-V3d: 별 카탈로그 출처가 어디인가요? (Hipparcos? Tycho?)
```

---

# 📋 미팅 체크리스트 (요약)

## 🔴 반드시 답변 받아야 할 질문

| # | 질문 | 답변 |
|---|------|------|
| 1 | 카메라 이미지 → 알고리즘 연결 코드 위치? | |
| 2 | 하드코딩 데이터 언제 실제 데이터로 교체? | |
| 3 | 자동 운용 모드 어디에 구현? | |
| 4 | 실제 운용 해상도? (1280×720? 2048×1088?) | |
| 5 | 실제 렌즈 FOV? (14° vs 26°) | |
| 6 | 픽셀 크기 5.5µm 기준은? | |
| 7 | 전력 예산 얼마? | |

## 📞 미팅 시 필수 요청 자료

1. **실제 광학계 스펙** (렌즈 FOV, 초점거리, 왜곡 계수)
2. **별 검출 코드 위치** (Threshold + CCL + Centroid)
3. **시스템 통합 테스트 결과**
4. **전력 실측 데이터**
5. **운용 시나리오 문서**
6. **OBC 통신 프로토콜 정의서**

---

# ⚠️ 최악의 시나리오

만약 위 질문들에 대한 답이 없다면:

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│  현재 코드 상태:                                                         │
│                                                                          │
│  1. 카메라 영상이 알고리즘에 전달되지 않음                              │
│  2. star_ID()는 항상 같은 하드코딩된 13개 별 좌표로 계산                │
│  3. 어떤 방향을 봐도 같은 자세값 출력                                    │
│  4. 자동 운용 모드 없음 (CLI 테스트만)                                  │
│  5. 파라미터가 실제 하드웨어와 최대 2.75배 불일치                       │
│                                                                          │
│  → 위성 자세 제어 불가능                                                 │
│  → 미션 실패                                                             │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 📝 미팅 후 기록

| 질문 # | 답변 요약 | 조치 필요 |
|--------|----------|----------|
| Q-C1 | | |
| Q-C2 | | |
| Q-C3 | | |
| Q-C4 | | |
| Q-H1 | | |
| Q-H2 | | |
| Q-H3 | | |
| Q-H4 | | |
| Q-P1 | | |
| Q-P2 | | |

---

**중요**: 이 문서를 인쇄해서 미팅에 가져가세요!

---

*작성: 2026-01-29*
*분석 도구: Claude Code*
